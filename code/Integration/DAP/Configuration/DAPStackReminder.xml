<?xml version="1.0" encoding="utf-8"?>
<DAPDirectives xmlns="http://www.brierley.com/DAPFileProcessing">
  <!-- General Configuration Parameters -->
  <DAPConfiguration>
    <Organization>AmericanEagle</Organization>
    <Environment>DevelopmentBline</Environment>
    <DAPDataType>GlobalAttributeSets</DAPDataType>
    <DateConversionFormat></DateConversionFormat>
    <TrimStrings>true</TrimStrings>
    <EmailInformation>
      <SMTPServer>cypwebmail.brierleyweb.com</SMTPServer>
      <SenderEmail>aejobs@brierley.com</SenderEmail>
      <SenderDisplayName>AE DAP Processor</SenderDisplayName>
      <RecepientEmail>aerewards_support@brierley.com</RecepientEmail>
      <Subject> Rewards Stacking Reminder Job DAP Processor</Subject>
    </EmailInformation>
    <DoNotProcess>false</DoNotProcess>
  </DAPConfiguration>
  <!-- Configuration parameters for message acquisition -->
  <InputProvider MessageProcessingScheme="Single" DebugOutputPath="E:\AmericanEagle\Files\Dummy">
    <SimpleDatabaseInput CollectionName="RewardsReminder" RecordName="Global">
		<QueryString>
			SELECT 0 AS ROWNO
			, CAST('LoyaltyID' AS NVARCHAR2(100)) LoyaltyID
			, CAST('CustomerID' AS NVARCHAR2(100)) CustomerID
			, CAST('EmailAddress' AS NVARCHAR2(150)) EmailAddress
			, CAST('Auth_CD' AS NVARCHAR2(100)) Auth_CD
			, CAST('SUC_CD' AS NVARCHAR2(100)) SUC_CD
			, CAST('Campaign_ExpDate' AS NVARCHAR2(100)) Campaign_ExpDate
			, CAST('EID' AS NVARCHAR2(100)) EID
			, CAST('OfferValue' AS NVARCHAR2(100)) OfferValue
			FROM Dual
			UNION
			SELECT 1 AS ROWNO
			,CAST(vc.loyaltyidnumber AS  NVARCHAR2(80)) AS LoyaltyID
			,CAST(vc.linkkey AS NVARCHAR2(80)) AS CustomerID
			,CAST(md.a_emailaddress AS  NVARCHAR2(150)) AS  EmailAddress
			,CAST(mr.offercode AS  NVARCHAR2(100)) AS Auth_CD
			,CAST(mr.certificatenmbr AS  NVARCHAR2(100)) AS SUC_CD
			,CAST(to_char(mr.expiration,'DD-Mon-YYYY') AS NVARCHAR2(80)) AS Campaign_ExpDate
			,CAST((SELECT CAST(cc.value AS NVARCHAR2(100)) FROM bp_ae.LW_CLIENTCONFIGURATION cc WHERE cc.ckey = 'EID_StackedReward') AS NVARCHAR2(100)) AS EID
			,CAST((REPLACE(REPLACE(rsc.a_typecode,'Stacked',''),'_1_1','')) AS NVARCHAR2(100)) AS OfferValue
			FROM bp_ae.lw_memberrewards mr
			INNER JOIN bp_ae.ats_rewardshortcode rsc
			ON mr.offercode = rsc.a_shortcode
			INNER JOIN bp_ae.lw_virtualcard vc
			ON vc.ipcode = mr.memberid
			INNER JOIN bp_ae.ats_memberdetails md
			ON md.a_ipcode = vc.ipcode
			INNER JOIN bp_ae.lw_loyaltymember lm
			ON lm.ipcode = md.a_ipcode
			WHERE 1=1
			AND rsc.a_typecode LIKE 'Stacked%'
			AND mr.redemptiondate IS NULL
			AND lm.memberstatus != 3
			ORDER BY RowNo
		</QueryString>
      <Fields>
	    <Field Name="ROWNO" Type="Integer"  />
        <Field Name="LoyaltyID" Type="String" />
        <Field Name="CustomerID" Type="String" />
		<Field Name="EmailAddress" Type="String" />
		<Field Name="Auth_CD" Type="String" />
		<Field Name="SUC_CD" Type="String" />
		<Field Name="Campaign_ExpDate" Type="String" />
		<Field Name="EID" Type="String" />
		<Field Name="OfferValue" Type="String" />
      </Fields>
    </SimpleDatabaseInput>
  </InputProvider>
  <MessageTransformationMap SourceCollectionName="RewardsReminder" TargetAttributeSetType="Global" DebugOutputPath="E:\AmericanEagle\Files\Dummy">
    <FieldMap SourceField="Global/LoyaltyID">
      <Populate TargetNode="Global/LoyaltyID"/>
    </FieldMap>
    <FieldMap SourceField="Global/CustomerID">
      <Populate TargetNode="Global/CustomerID"/>
    </FieldMap>
    <FieldMap SourceField="Global/EmailAddress">
      <Populate TargetNode="Global/EmailAddress"/>
    </FieldMap>
	<FieldMap SourceField="Global/Auth_CD">
      <Populate TargetNode="Global/Auth_CD"/>
    </FieldMap>
	<FieldMap SourceField="Global/SUC_CD">
      <Populate TargetNode="Global/SUC_CD"/>
    </FieldMap>
	<FieldMap SourceField="Global/Campaign_ExpDate">
      <Populate TargetNode="Global/Campaign_ExpDate"/>
    </FieldMap>
	<FieldMap SourceField="Global/EID">
      <Populate TargetNode="Global/EID"/>
    </FieldMap>
	<FieldMap SourceField="Global/OfferValue">
      <Populate TargetNode="Global/OfferValue"/>
    </FieldMap>
  </MessageTransformationMap>
  <OutputProvider>
   <DelimetedFileOutput CollectionName="AttributeSets" RecordName="Global" FileName="AEORW_EM_BACKLOG_{$date(format=yyyyMMddhhmmss)}.txt" DataInAttributes="false"  Delimiter="|" OutputFolder="E:\AmericanEagle\Files\Outbound">
      <FieldMap>     
		    <Field Name="LoyaltyID" Length="100" />
		    <Field Name="CustomerID" Length="100" />
		    <Field Name="EmailAddress" Length="100" />
		    <Field Name="Auth_CD" Length="100" />
		    <Field Name="SUC_CD" Length="100" />
		    <Field Name="Campaign_ExpDate" Length="100" />
		    <Field Name="EID" Length="100" />
		    <Field Name="OfferValue" Length="100" />
        </FieldMap>
    </DelimetedFileOutput>
  </OutputProvider>
</DAPDirectives>