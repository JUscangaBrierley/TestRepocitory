<?xml version="1.0" encoding="utf-8"?>
<DAPDirectives xmlns="http://www.brierley.com/DAPFileProcessing">
  <!-- General Configuration Parameters -->
  <DAPConfiguration>
    <Organization>AmericanEagle</Organization>
    <Environment>DevelopmentBline</Environment>
    <DAPDataType>MemberAttributeSets</DAPDataType>
    <DateConversionFormat></DateConversionFormat>
    <TrimStrings>true</TrimStrings>
    <EmailInformation>
      <SMTPServer>cypwebmail.brierleyweb.com</SMTPServer>
      <SenderEmail>aejobs@brierley.com</SenderEmail>
      <SenderDisplayName>AE DAP Processor</SenderDisplayName>
	  <RecepientEmail>aerewards_support@brierley.com</RecepientEmail>
	  <Subject>AE Tlog DAP Processor</Subject>
    </EmailInformation>
    <!--<DoNotProcess>true</DoNotProcess>-->
  </DAPConfiguration>
  <!-- Configuration parameters for message acquisition -->
    <!--<InputProvider MessageProcessingScheme="Batch" DebugOutputPath="E:\devroot\Loyaltyware\Data\TLOG\Stage1Out">-->
  <InputProvider MessageProcessingScheme="Batch" DebugOutputPath="E:\AmericanEagle\Logs">	
    <StagedTlogDatabaseInput MemberRetrievalRange="0-*"
                             MemberRetrievalBatchSize="10000" ProcessRewards="false" ProcessTenders="true"
                             StagingDetailTable="bp_ae.stage_txndetailheader" StageDetailLoadMethod="TxnLoyaltyId"
                             StagingTenderTable="bp_ae.stage_txntender" 
							 StagingDiscountTable="false"
							 StagingRewardsTable="false" 
							 CheckProcessId="false">
      <TlogMessageProducer>
        <TypeName>Brierley.LoyaltyWare.DataAcquisition.Core.Input.DbProvider.StagedTlogMessageHelper</TypeName>
        <AssemblyName>Brierley.LoyaltyWare.DataAcquisition.Core.dll</AssemblyName>
        <Parameters>
          <Parameter Name="DataInAttributes" Value="true" />          
        </Parameters>
      </TlogMessageProducer>
	  <DetailFields>
		<Field Name="VcKey" Type="Long" Required="true"/>
		<Field Name="TxnLoyaltyId" Type="String" Required="true"/>		
		<Field Name="IpCode" Type="Long" Required="true" SpecialType="Header"/>
		<Field Name="TxnDate" Type="Date" Required="true" SpecialType="HeaderDetail"/>
		<Field Name="TxnStoreId" Type="Integer" Required="true" SpecialType="HeaderDetail"/> 
		<Field Name="TxnNumber" Type="String" Required="false" SpecialType="Header"/>		
		<Field Name="TxnRegisterNumber" Type="String" Required="true" SpecialType="Header"/>
		<Field Name="OrderNumber" Type="String" Required="false" SpecialType="Header"/>
		<Field Name="TxnHeaderId" Type="String" Required="true" SpecialType="HeaderDetail"/>
		<Field Name="ShipDate" Type="Date" Required="false" SpecialType="Header"/>
		<Field Name="TxnQualPurchaseAmt" Type="Decimal" Required="false" SpecialType="Header"/>
		<Field Name="ExcludePointAccrual" Type="Integer" Required="false" SpecialType="Header"/> 
		<Field Name="BrandId" Type="String" Required="false" SpecialType="Header"/>
		<Field Name="CreditCardId" Type="Long" Required="false" SpecialType="Header"/>
		<Field Name="TxnMaskId" Type="String" Required="false" SpecialType="Header"/>
		<Field Name="TxnTypeId" Type="Integer" Required="true" SpecialType="Header"/>
		<Field Name="TxnAmount" Type="Decimal" Required="false" SpecialType="Header"/> 
		<Field Name="TxnDiscountAmount" Type="Decimal" Required="false" SpecialType="Header"/>
		<Field Name="TxnEmployeeId" Type="String" Required="false" SpecialType="Header"/>
		<Field Name="TxnChannel" Type="String" Required="false" SpecialType="Header"/>
		<!-- <Field Name="TxnOriginalTxnRowKey" Type="Integer" Required="false" SpecialType="Header"/> -->
		<Field Name="TxnCreditsUsed" Type="Integer" Required="false" SpecialType="Header"/>
		<Field Name="StatusCode" Type="Long" Required="false" SpecialType="HeaderDetail"/>
		<Field Name="StoreNumber" Type="Integer" Required="false" SpecialType="Header"/>
		<!-- <Field Name="TxnOriginalStoreId" Type="Integer" Required="false" SpecialType="Header"/> -->
		<!-- <Field Name="TxnOriginalTxnDate" Type="Date" Required="false" SpecialType="Header"/> -->
		<!-- <Field Name="TxnOriginalTxnNumber" Type="String" Required="false" SpecialType="Header"/> -->
		<Field Name="CurrencyCode" Type="String" Required="false" SpecialType="Header"/>	
		<Field Name="CurrencyRate" Type="Decimal" Required="false" SpecialType="Header"/>
		<Field Name="AECCMultiplier" Type="Integer" Required="false" SpecialType="Header"/>
		<!-- <Field Name="OriginalOrderNumber" Type="String" Required="false" SpecialType="Header"/> -->
		<Field Name="CashierNumber" Type="String" Required="false" SpecialType="Header"/>
		<Field Name="TxnTaxAmount" Type="Decimal" Required="false" SpecialType="Header"/>
        <Field Name="TxnStoreToDoor" Type="Integer" Required="false" SpecialType="Header"/>
		<Field Name="TxnFoundOrderNumber" Type="String" Required="false" SpecialType="Header"/> 		
		<Field Name="RowKey" Type="Long" Required="true"/>
		<Field Name="ReasonCode" Type="String" Required="false" SpecialType="Detail"/>
		<Field Name="TxnDetailId" Type="String" Required="true" SpecialType="Detail"/>
		<Field Name="DtlItemLineNbr" Type="Integer" Required="false" SpecialType="Detail"/>
		<Field Name="DtlProductId" Type="Integer" Required="false" SpecialType="Detail"/>
		<Field Name="DtlTypeId" Type="Integer" Required="false" SpecialType="Detail"/>
		<Field Name="DtlActionId" Type="Integer" Required="false" SpecialType="Detail"/>
		<Field Name="DtlRetailAmount" Type="Decimal" Required="true" SpecialType="Detail"/>
		<Field Name="DtlSaleAmount" Type="Decimal" Required="true" SpecialType="Detail"/>
		<Field Name="DtlQuantity" Type="Integer" Required="false" SpecialType="Detail"/>
		<Field Name="DtlDiscountAmount" Type="Decimal" Required="true" SpecialType="Detail"/>
		<Field Name="DtlClearanceItem" Type="Integer" Required="true" SpecialType="Detail"/>
		<Field Name="DtlClassCode" Type="String" Required="false" SpecialType="Detail"/>
		<Field Name="DtlSaleAmount_Org" Type="Decimal" Required="false" SpecialType="Detail"/>
		<Field Name="TxnOriginalStoreId" Type="Integer" Required="false" SpecialType="Detail"/>
		<Field Name="TxnOriginalTxnDate" Type="Date" Required="false" SpecialType="Detail"/> 
		<Field Name="TxnOriginalTxnNumber" Type="String" Required="false" SpecialType="Detail"/>
        <Field Name="TxnOriginalOrderNumber" Type="String" Required="false" SpecialType="Detail"/>
        <Field Name="OriginalTxnTenderRatio" Type="Decimal" Required="false" SpecialType="Detail"/>
		<Field Name="OriginalTxnQualPurchaseAmt" Type="Decimal" Required="false" SpecialType="Detail"/>	
		<Field Name="TxnFulFilledStoreId" Type="Integer" Required="false" SpecialType="Detail"/>
        <Field Name="CertificateTypeCode" Type="String" Required="false" SpecialType="Detail"/>
        <Field Name="ExcludeQualifiedPurchase" Type="Integer" Required="false" SpecialType="Detail"/>
        <Field Name="CertificateNumber" Type="String" Required="false" SpecialType="Detail"/>
		<Field Name="OriginalTxnAmount" Type="Decimal" Required="false" SpecialType="Detail"/>	
		<Field Name="OriginalAECCTenderAmount" Type="Decimal" Required="false" SpecialType="Detail"/>
		<Field Name="OriginalExcludePointAccrual" Type="Integer" Required="false" SpecialType="Detail"/> 		
      </DetailFields>
	   <TenderFields>
		<Field Name="TxnLoyaltyId" Type="String" Required="true"/>
        <Field Name="TxnTenderId" Type="String" Required="true"/>	
		<Field Name="TxnHeaderId" Type="String" Required="true"/>
		<Field Name="RowKey" Type="Long" Required="true"/>
		<Field Name="IpCode" Type="Long" Required="true"/>
		<Field Name="VcKey" Type="Long" Required="true"/>
		<Field Name="RoundedAmount" Type="Long" Required="false"/>
		<Field Name="TxnDate" Type="Date" Required="false"/>
		<Field Name="TxnStoreId" Type="Integer" Required="false"/>
		<Field Name="TenderType" Type="Integer" Required="true"/>
		<Field Name="TenderAmount" Type="Decimal" Required="true"/>
		<Field Name="TenderCurrency" Type="String" Required="false"/>
		<Field Name="TenderTaxAmount" Type="Decimal" Required="true"/>
		<Field Name="TenderTaxRate" Type="Decimal" Required="true"/>
		<Field Name="StatusCode" Type="Long" Required="false"/>
		<Field Name="TenderLineNbr" Type="Integer" Required="false"/>
		</TenderFields>

    </StagedTlogDatabaseInput>
  </InputProvider>
  <!-- Configuration for message transformation -->
  <!-- Output Provider -->
  <OutputProvider>
    <FrameworkOutput>
      <!-- Configuration for Dispatcher messages over threads -->
      <DispatcherConfiguration>
        <ThreadPoolSize>14</ThreadPoolSize>
        <NumberOfRetries>10</NumberOfRetries>
        <RequestsPerThread></RequestsPerThread>
        <CheckForChangedValues>true</CheckForChangedValues>
        <SerializeMembers>true</SerializeMembers>
        <!--<SerializationPolicy>MemberKey</SerializationPolicy>
        <SerializationMethod LookupMethod="IpCode" ValuePath="Member/IpCode"/>-->
      </DispatcherConfiguration>
      <!-- Final processing directives -->
      <FrameworkBoundMessageProcessingDirectives>
        <InterceptorAssembly ReuseForFile="true">
          <InterceptorAssemlyName>AmericanEagle.SDK.dll</InterceptorAssemlyName>
          <InterceptorTypeName>AmericanEagle.SDK.Interceptors.AmericanEagleTLogInterceptor</InterceptorTypeName> 
        </InterceptorAssembly>
        <ClientDataModel>
          <MemberLoadDirectives ExceptionIfNotFound="true" ExceptionIfFound="false">
            <!--<LoadDirective Method="IpCode" ValuePath="Member/IpCode"/>-->
            <LoadDirective Method="LoyaltyIdNumber" ValuePath="Member/VirtualCard/LoyaltyIdNumber"/>
          </MemberLoadDirectives>
          <AttributeSetCreateDirectives>
            <AttributeSetUpdate Name="VirtualCard" FindMethod="Attribute" FindValue="LoyaltyIdNumber" CreateIfNotFound="false"/>            
          </AttributeSetCreateDirectives>
        </ClientDataModel>
      </FrameworkBoundMessageProcessingDirectives>
    </FrameworkOutput>
  </OutputProvider>
</DAPDirectives>