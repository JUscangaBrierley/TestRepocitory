<?xml version="1.0" encoding="utf-8"?>
<DAPDirectives xmlns="http://www.brierley.com/DAPFileProcessing">
  <!-- General Configuration Parameters -->
  <DAPConfiguration>
    <Organization>AmericanEagle</Organization>
    <Environment>DevelopmentBline</Environment>
    <DAPDataType>GlobalAttributeSets</DAPDataType>
    <DateConversionFormat></DateConversionFormat>
    <TrimStrings>true</TrimStrings>
    <EmailInformation>
      <SMTPServer>cypwebmail.brierleyweb.com</SMTPServer>
      <SenderEmail>aejobs@brierley.com</SenderEmail>
      <SenderDisplayName>AE DAP Processor</SenderDisplayName>
      <RecepientEmail>aerewards_support@brierley.com</RecepientEmail>
      <Subject>AE Rewards Early File-USA Send  DAP Processor</Subject>
    </EmailInformation>
    <DoNotProcess>false</DoNotProcess>
  </DAPConfiguration>
  <!-- Configuration parameters for message acquisition -->
  <InputProvider MessageProcessingScheme="Single" DebugOutputPath="E:\LoyaltyWare\DevRoot\AmericanEagle\Data\WeeklyFeed\Development1">
    <SimpleDatabaseInput CollectionName="MemberRewards" RecordName="MemberReward">
      <QueryString>
        SELECT
        lpad(rownum, '10', '0') as RowNumber,
        fl.a_loyaltynumber as LoyaltyNumber,
        fl.a_hhkeybarcode as HHKey,
        '' as Prefix,
        case fl.a_isunderage
        When 1 Then cast('' as NVARCHAR2(50))
        Else
        UPPER(fl.a_firstname)
        End as FirstName,
        UPPER(fl.a_lastname) as LastName,
        '' as Suffix,
        UPPER(fl.a_addresslineone) as Line1,
        UPPER(fl.a_addresslinetwo) as Line2,
        '' as Company,
        UPPER(fl.a_city) as City,
        UPPER(substr(fl.a_stateorprovince, 1, 2)) as State,
        fl.a_ziporpostalcode as PostalCode,
        fl.a_country as Country,
        '' as Filler1,
        'J1001-100' as Program,
        fl.a_barcode as OfferCode,
        Case instr(fl.a_rewarddescription, '%')
        When 0 Then 'ER00' || lpad(REPLACE(fl.a_rewarddescription, '$', ''), '3', '0')
        Else 'MR00' || lpad(REPLACE(fl.a_rewarddescription, '%', ''), 3, '0')
        END as RewardLevel,
        fl.a_startingpoints as StartingCredits,
        fl.a_basepointbalance as BaseCredits,
        fl.a_bonuspointbalance as BonusCredits,
        fl.a_pointsredeemed as RedeemedCredits,
        fl.a_basepointbalance + fl.a_bonuspointbalance as TotalCredits,
        lpad(fl.a_rewardpartnumber, '3', '0') as CertificateReasonCode,
        case
        when fl.a_isunderage = 1 then 'Y'
        else 'N'
        end as UnderAge,
        Case
        When fl.a_extendedplaycode = 2 Then 0
        When fl.a_extendedplaycode = 3 Then 0
        Else fl.a_extendedplaycode
        End as HighTier,
        fl.a_languagepreference as LanguagePreference,
        fl.a_purchasedaebrand as AEBrand,
        fl.a_purchasedaeriebrand as AerieBrand,
        fl.a_purchasedkidsbrand as KidsBrand,
        lpad(fl.a_baseloyaltybrand, '2', '0') as BaseLoyaltyBrand,
        '' as Filler2
        FROM    ATS_EARLYREWARDFULFILLMENT fl
        INNER JOIN lw_memberrewards mr on fl.a_memberrewardid = mr.id
        WHERE   mr.ordernumber = '4'
      </QueryString>
      <Fields>
        <Field Name="RowNumber" Type="String"  />
        <Field Name="LoyaltyNumber" Type="String" />
        <Field Name="HHKey" Type="String" />
        <Field Name="Prefix" Type="String" />
        <Field Name="FirstName" Type="String" />
        <Field Name="LastName" Type="String" />
        <Field Name="Suffix" Type="String" />
        <Field Name="Line1" Type="String" />
        <Field Name="Line2" Type="String" />
        <Field Name="Company" Type="String" />
        <Field Name="City" Type="String" />
        <Field Name="State" Type="String" />
        <Field Name="PostalCode" Type="String" />
        <Field Name="Country" Type="String" />
        <Field Name="Filler1" Type="String" />
        <Field Name="Program" Type="String" />
        <Field Name="OfferCode" Type="String" />
        <Field Name="RewardLevel" Type="String" />
        <Field Name="StartingCredits" Type="String" />
        <Field Name="BaseCredits" Type="String" />
        <Field Name="BonusCredits" Type="String" />
        <Field Name="RedeemedCredits" Type="String" />
        <Field Name="TotalCredits" Type="String" />
        <Field Name="CertificateReasonCode" Type="String" />
        <Field Name="UnderAge" Type="String" />
        <Field Name="HighTier" Type="String" />
        <Field Name="LanguagePreference" Type="String" />
        <Field Name="AEBrand" Type="String" />
        <Field Name="AerieBrand" Type="String" />
        <Field Name="KidsBrand" Type="String" />
        <Field Name="BaseLoyaltyBrand" Type="String" />
        <Field Name="Filler2" Type="String" />
      </Fields>
    </SimpleDatabaseInput>
  </InputProvider>
  <!-- Output provider -->
  <OutputProvider>
    <FixedRecordFileOutput CollectionName="MemberRewards" FileName="QR1001_{$date(format=yyyyddMM)}_{$date(format=hhmmss)}.txt" Justification="Left" OutputFolder="C:\devroot\americaneagle\Trunk\LogFiles" RecordName="MemberReward">
      <FieldMap>
        <Field Name="RowNumber" Justification="Left" Length="10" />
        <Field Name="LoyaltyNumber" Justification="Left" Length="14" />
        <Field Name="HHKey" Justification="Left" Length="16" />
        <Field Name="Prefix" Justification="Right" Length="17" />
        <Field Name="FirstName" Justification="Left" Length="30" />
        <Field Name="LastName" Justification="Left" Length="30" />
        <Field Name="Suffix" Justification="Left" Length="10" />
        <Field Name="Line1" Justification="Left" Length="40" />
        <Field Name="Line2" Justification="Left" Length="40" />
        <Field Name="Company" Justification="Left" Length="40" />
        <Field Name="City" Justification="Left" Length="30" />
        <Field Name="State" Justification="Left" Length="2" />
        <Field Name="PostalCode" Justification="Left" Length="10" />
        <Field Name="Country" Justification="Left" Length="25" />
        <Field Name="Filler1" Justification="Left" Length="25" />
        <Field Name="Program" Justification="Left" Length="20" />
        <Field Name="OfferCode" Justification="Left" Length="20" />
        <Field Name="RewardLevel" Justification="Left" Length="10" />
        <Field Name="StartingCredits" Justification="Left" Length="6" />
        <Field Name="BaseCredits" Justification="Left" Length="6" />
        <Field Name="BonusCredits" Justification="Left" Length="6" />
        <Field Name="RedeemedCredits" Justification="Left" Length="6" />
        <Field Name="TotalCredits" Justification="Left" Length="10" />
        <Field Name="CertificateReasonCode" Justification="Left" Length="3" />
        <Field Name="UnderAge" Justification="Left" Length="1" />
        <Field Name="HighTier" Justification="Left" Length="1" />
        <Field Name="LanguagePreference" Justification="Left" Length="1" />
        <Field Name="AEBrand" Justification="Left" Length="1" />
        <Field Name="AerieBrand" Justification="Left" Length="1" />
        <Field Name="KidsBrand" Justification="Left" Length="1" />
        <Field Name="BaseLoyaltyBrand" Justification="Left" Length="2" />
        <Field Name="Filler2" Justification="Left" Length="81" />
      </FieldMap>
    </FixedRecordFileOutput>
  </OutputProvider>
</DAPDirectives>